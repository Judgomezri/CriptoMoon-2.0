#:import Clipboard kivy.core.clipboard.Clipboard

<MenuScreen>:
    AnchorLayout:
        anchor_x: "center"
        anchor_y: "center"
        Image:
            source: "fromMoon.jpg"
            allow_stretch: True
            keep_ratio: False
        BoxLayout:
            spacing: 15
            orientation: "vertical"
            size_hint: .8, .5
            #width: "300dp"
            Image:
                source: "Logo.png"
                width: 1
            Label:
            Button:
                text: 'Llave Pública'
                on_press: root.manager.current = 'LlavePublica'
                width: .5
                    
            Button:
                text: 'Quit'
                width: .5
                on_press: app.stop()
        

<LlavePublica_Screen>:
    Image:
        source: "space.jpg"
        allow_stretch: True
        keep_ratio: False
    BoxLayout:
        spacing: 10
        padding: 15, 15
        orientation: "vertical"
        GridLayout:
            cols: 2
            #Opciones de Cifrado
            GridLayout:
                spacing: 10, 10
                cols: 2
                Label:
                    text: "Cifrador "
                Spinner:
                    id: cifrador
                    text: "Seleccione una opción..."
                    values: ["RSA","Rabin", "ElGamal", "Menezes Vanestone"]
                    on_text: root.spinner_clicked(cifrador.text, data)
                Label:
                    text: "Primo 1"
                TextInput:
                    id: primo1
                    disabled: not data.visible
                Label:
                    text: "Primo 2"
                TextInput:
                    id: primo2   
                    disabled: False if cifrador.text!="ElGamal" and data.visible else True  
                Button:
                    text: 'Generar Primos'
                    on_press: root.generarPrimos(cifrador.text, primo1,primo2)
                Button:
                    text: 'Generar Datos'
                    on_press: root.generarDatos(cifrador.text, primo1,primo2, data1, data2, data3, data4, data5)

            #Datos Generados
            GridLayout:
                id : data
                visible: False
                spacing: 10, 10
                cols: 2
                Label:
                    text: "n" if (cifrador.text == "RSA" or cifrador.text=="Rabin") else "α" if cifrador.text=="ElGamal" else "a" if cifrador.text=="Menezes Vanestone"  else ""
                    size_hint_x: .4 if data.visible else 0
                    opacity: 1 if cifrador.text != "" else 0
                TextInput:
                    id: data1
                    size_hint_x: 1 if data.visible else 0
                    opacity: 1 if data.visible else 0
                    disabled: not data.visible
                Label:
                    text: "Φ(n)" if cifrador.text == "RSA" else "β" if cifrador.text=="ElGamal" else "b" if cifrador.text=="Menezes Vanestone"  else ""
                    size_hint_x: .4 if data.visible else 0
                    opacity: 1 if data.visible and cifrador.text!="Rabin" else 0
                TextInput:
                    id: data2
                    size_hint_x: 1 if data.visible else 0
                    opacity: 1 if data.visible and cifrador.text!="Rabin" else 0
                    disabled: not data.visible
                Label:
                    text: "Clave Pública" if cifrador.text == "RSA" else "Data 2 Rabin" if cifrador.text=="Rabin" else "p" if cifrador.text=="Menezes Vanestone"  else ""
                    size_hint_x: .4 if data.visible and cifrador.text!="Menezes Vanestone" else 0
                    size_hint_y: 1 if data.visible and cifrador.text!="Menezes Vanestone" else 0
                    opacity: 1 if data.visible and cifrador.text!="Rabin" and cifrador.text!="ElGamal" and cifrador.text!="Menezes Vanestone" else 0
                TextInput:
                    id: data3
                    size_hint_x: 1 if data.visible and cifrador.text!="Menezes Vanestone" else 0
                    size_hint_y: 1 if data.visible and cifrador.text!="Menezes Vanestone" else 0
                    opacity: 1 if data.visible and cifrador.text!="Rabin" and cifrador.text!="ElGamal" and cifrador.text!="Menezes Vanestone" else 0
                BoxLayout:
                    spacing: 10
                    size_hint_x: 1 if cifrador.text=="Menezes Vanestone" else 0
                    opacity: 1 if cifrador.text=="Menezes Vanestone" else 0
                    Label:
                        text: "gx"
                        size_hint_x: .4 
                    TextInput:
                        id: data4
                        size_hint_x: 1
                BoxLayout:
                    spacing: 10
                    size_hint_x: 1 if cifrador.text=="Menezes Vanestone" else 0
                    opacity: 1 if cifrador.text=="Menezes Vanestone" else 0
                    Label:
                        text: "gy"
                        size_hint_x: .4 
                    TextInput:
                        id: data5
                        size_hint_x: 1

        #Cifrar
        GridLayout:
            cols: 2
            spacing: 15, 15
            Label: 
                text: "Texto"
                size_hint: 1, .3
            Label:
                text: "Resultado"
                size_hint: 1, .3
            TextInput:
                border: 5,5,5,5
                id: Texto
            TextInput:
                id: Resultado
        #Botones de cifrado
        GridLayout:
            size_hint: 1,.3
            cols: 5
            spacing: 10, 10
            Button:
                text: "Cifrar"
                on_press: root.cifrar(cifrador.text, primo1.text,primo2.text, data1, data2, data3, data4, data5, Texto, Resultado)
            Button:
                text: "Descifrar"
                on_press: root.descifrar(cifrador.text, primo1.text,primo2.text, data1, data2, data3, data4, data5, Texto, Resultado)
            Button:
                text: "Pegar"
                on_release: Texto.text = Clipboard.paste()
            Button:
                text: "Limpiar"
                on_release: 
                    Texto.text=""
                    Resultado.text=""
            Button:
                text: "Copiar"
                on_release: Clipboard.copy(Resultado.text)
        Label:
            size_hint: 1, .2

        Button:
            pos_hint: {"center_x": .5}
            size_hint:.5, .2
            text: 'Volver al menú'
            on_press: root.manager.current = 'menu'
